<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pac-Man Original</title>
    
    <style>
        /* Variáveis de Design */
        :root {
            --map-size: 21; /* Mapa 21x21 */
            --cell-size: 25px; 
            --pac-color: #ffd700; /* Ouro */
            --wall-color: #0000aa; /* Azul Marinho */
            --dot-color: #f7f7f7; 
            --power-pellet-color: #ffaa00;
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #111;
            margin: 0;
            font-family: 'Arial', sans-serif;
        }

        #score-board {
            color: var(--pac-color);
            font-size: 2em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(var(--map-size), var(--cell-size));
            grid-template-rows: repeat(var(--map-size), var(--cell-size));
            border: 2px solid #333;
            background-color: #000;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }

        /* ---------------- Estilos dos Elementos do Jogo ---------------- */

        .wall {
            background-color: var(--wall-color);
            border: 1px solid var(--wall-color);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .dot {
            background-color: transparent;
        }

        .dot::after {
            content: '';
            display: block;
            width: 4px;
            height: 4px;
            background-color: var(--dot-color);
            border-radius: 50%;
        }

        .power-pellet::after {
            content: '';
            display: block;
            width: 12px;
            height: 12px;
            background-color: var(--power-pellet-color);
            border-radius: 50%;
            animation: pulse 0.5s infinite alternate;
        }

        .pacman {
            background-color: transparent;
            position: relative;
            animation: mouth-open 0.1s infinite alternate; /* Animação simples da boca */
        }

        .pacman::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: var(--pac-color);
            border-radius: 50%;
            clip-path: polygon(50% 50%, 100% 30%, 100% 70%); /* Boca semi-aberta */
        }

        /* Rotação e Animação de Boca */
        .pacman.up::before { transform: rotate(270deg); }
        .pacman.down::before { transform: rotate(90deg); }
        .pacman.left::before { transform: rotate(180deg); }
        .pacman.right::before { transform: rotate(0deg); }

        .empty {
            background-color: #000;
        }

        /* Estilos Fantasma (Base) */
        .ghost {
            background-color: transparent;
            position: relative;
        }

        .ghost::after {
            content: '';
            display: block;
            width: 80%;
            height: 80%;
            border-radius: 50% 50% 5px 5px;
            position: absolute;
            top: 10%;
            left: 10%;
        }

        /* Cores dos Fantasmas Clássicos */
        .ghost.blinky::after { background-color: #ff0000; } /* Vermelho */
        .ghost.pinky::after { background-color: #ffb8ff; } /* Rosa */
        .ghost.inky::after { background-color: #00ffff; } /* Ciano */
        .ghost.clyde::after { background-color: #ffb851; } /* Laranja */

        /* Animações */
        @keyframes mouth-open {
            from { clip-path: polygon(50% 50%, 100% 40%, 100% 60%); } /* Boca mais fechada */
            to { clip-path: polygon(50% 50%, 100% 0%, 100% 100%); } /* Boca mais aberta */
        }
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.3); }
        }
    </style>
</head>
<body>
    <div id="score-board">PONTOS: 0</div>
    <div id="game-board"></div>

    <script>
        const MAP_SIZE = 21;
        const TILE_SIZE = 25; 
        const gameBoard = document.getElementById('game-board');
        const scoreBoard = document.getElementById('score-board');
        let score = 0;
        let gameLoopInterval;
        const FPS = 10; // Taxa de atualização (100ms por frame)

        // 0: Vazio/Caminho, 1: Parede, 2: Ponto, 3: Power Pellet, 4: Fantasma (Casa), 5: Pac-Man (Posição Inicial)
        // Mapa 21x21 (Estrutura simplificada de um labirinto)
        const map = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,3,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,3,1],
            [1,2,1,1,1,2,1,1,2,1,2,1,2,1,1,1,2,1,1,2,1],
            [1,2,1,1,1,2,1,1,2,2,2,2,2,1,1,1,2,1,1,2,1],
            [1,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,1],
            [1,2,1,1,1,2,1,2,1,1,1,1,1,2,1,2,1,1,1,2,1],
            [1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,1],
            [1,1,1,1,1,2,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1],
            [0,0,0,0,1,2,1,2,4,4,4,2,1,2,1,0,0,0,0,0,0], // Saída do Pac-Man (0,0,0,0,1...) e Casa dos Fantasmas (4)
            [1,1,1,1,1,2,1,2,4,4,4,2,1,2,1,1,1,1,1,1,1],
            [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
            [1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1],
            [1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1],
            [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
            [1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1],
            [1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
            [1,2,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,1],
            [1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];
        
        // Posições
        let pacman = { x: 1, y: 1, direction: 'right', nextDirection: 'right' };
        let ghosts = [
            { id: 'blinky', x: 10, y: 8, direction: 'left', className: 'blinky' },
            { id: 'pinky', x: 9, y: 9, direction: 'up', className: 'pinky' },
            // ... (adicionar mais fantasmas e lógica de IA)
        ];

        // ----------------- FUNÇÕES DE DESENHO -----------------

        function drawMap() {
            gameBoard.innerHTML = '';
            for (let y = 0; y < map.length; y++) {
                for (let x = 0; x < map[y].length; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    
                    switch (map[y][x]) {
                        case 1: cell.classList.add('wall'); break;
                        case 2: cell.classList.add('dot'); break;
                        case 3: cell.classList.add('power-pellet'); break;
                        case 0: 
                        case 4: cell.classList.add('empty'); break; // 4 é a casa dos fantasmas
                    }
                    
                    // Desenha Pac-Man
                    if (y === pacman.y && x === pacman.x) {
                        cell.classList.add('pacman', pacman.direction);
                    }

                    // Desenha Fantasmas
                    ghosts.forEach(ghost => {
                        if (y === ghost.y && x === ghost.x) {
                            cell.classList.remove('empty', 'dot', 'pacman');
                            cell.classList.add('ghost', ghost.className);
                        }
                    });

                    gameBoard.appendChild(cell);
                }
            }
        }

        // ----------------- LÓGICA DE MOVIMENTO -----------------

        function getDelta(direction) {
            switch (direction) {
                case 'up': return { dx: 0, dy: -1 };
                case 'down': return { dx: 0, dy: 1 };
                case 'left': return { dx: -1, dy: 0 };
                case 'right': return { dx: 1, dy: 0 };
                default: return { dx: 0, dy: 0 };
            }
        }

        function checkCollision(x, y) {
            // Verifica se está dentro dos limites e não é parede
            if (y >= 0 && y < MAP_SIZE && x >= 0 && x < MAP_SIZE) {
                return map[y][x] !== 1; // Retorna true se NÃO for parede
            }
            return false;
        }

        function gameTick() {
            // 1. Tenta mover Pac-Man na direção desejada (sem delay)
            let { dx: nextDx, dy: nextDy } = getDelta(pacman.nextDirection);
            
            if (checkCollision(pacman.x + nextDx, pacman.y + nextDy)) {
                // Se o próximo movimento for válido, muda a direção
                pacman.direction = pacman.nextDirection;
            } else {
                // Se não puder seguir a direção desejada, tenta continuar na direção atual
                let { dx: currentDx, dy: currentDy } = getDelta(pacman.direction);
                if (!checkCollision(pacman.x + currentDx, pacman.y + currentDy)) {
                    // Parado
                    nextDx = 0; 
                    nextDy = 0;
                } else {
                    nextDx = currentDx;
                    nextDy = currentDy;
                }
            }
            
            // 2. Aplica o movimento
            pacman.x += nextDx;
            pacman.y += nextDy;

            // 3. Lógica de Comer
            const currentTile = map[pacman.y][pacman.x];
            if (currentTile === 2) {
                map[pacman.y][pacman.x] = 0; // Come o ponto
                score += 10;
            } else if (currentTile === 3) {
                map[pacman.y][pacman.x] = 0; // Come o Power Pellet
                score += 50;
                // Ativar modo Fantasma Azul (necessita de mais lógica de jogo)
            }
            
            scoreBoard.textContent = `PONTOS: ${score}`;

            // 4. Lógica Básica de Movimento dos Fantasmas (Apenas Blinky)
            ghosts.forEach(ghost => {
                // IA Simplificada: Tenta se mover aleatoriamente
                const directions = ['up', 'down', 'left', 'right'];
                const validMoves = directions.filter(dir => {
                    const { dx, dy } = getDelta(dir);
                    return checkCollision(ghost.x + dx, ghost.y + dy);
                });

                if (validMoves.length > 0) {
                    const newDirection = validMoves[Math.floor(Math.random() * validMoves.length)];
                    const { dx, dy } = getDelta(newDirection);

                    // Verifica se o fantasma não está voltando imediatamente, se possível
                    const opposite = { 'up': 'down', 'down': 'up', 'left': 'right', 'right': 'left' };
                    if (validMoves.length > 1 && newDirection === opposite[ghost.direction]) {
                        // Tenta escolher outro caminho
                    }

                    ghost.x += dx;
                    ghost.y += dy;
                    ghost.direction = newDirection;
                }

                // 5. Verificação de Colisão com Fantasma
                if (pacman.x === ghost.x && pacman.y === ghost.y) {
                    gameOver();
                }
            });

            drawMap();
        }

        // ----------------- CONTROLE E INICIALIZAÇÃO -----------------

        function handleInput(e) {
            let newDirection = null;
            switch (e.key) {
                case 'ArrowUp':
                case 'w':
                    newDirection = 'up';
                    break;
                case 'ArrowDown':
                case 's':
                    newDirection = 'down';
                    break;
                case 'ArrowLeft':
                case 'a':
                    newDirection = 'left';
                    break;
                case 'ArrowRight':
                case 'd':
                    newDirection = 'right';
                    break;
            }
            if (newDirection) {
                pacman.nextDirection = newDirection; // Armazena o próximo movimento
            }
        }

        function gameOver() {
            clearInterval(gameLoopInterval);
            alert(`Fim de Jogo! Sua Pontuação Final: ${score}`);
            // Adicionar lógica de reinício aqui
        }

        document.addEventListener('keydown', handleInput);

        // Inicializa o jogo e o loop
        drawMap();
        gameLoopInterval = setInterval(gameTick, 1000 / FPS); // 1000ms / 10 FPS = 100ms
    </script>
</body>
</html>
